import os

from jinja2 import StrictUndefined
from flask import Flask, render_template, redirect, request, flash, session, url_for, jsonify
# from flask_debugtoolbar import DebugToolbarExtension

from utils import dictify
from road import make_result, make_recommendation
from model import User, Label, Addr, connect_to_db, db

import time

app = Flask(__name__)

# Remember to ``source secrets.sh``!
# Required to use Flask sessions and the debug toolbar.
app.secret_key = os.environ['FLASK_SECRET_KEY']

# Required to pass JavaScript API key to render_template.
jskey = os.environ['GOOGLE_API_JAVASCRIPT_KEY']

# Set to StrictUndefined so that Jinja will raise an error if you use an
# undefined variable.
app.jinja_env.undefined = StrictUndefined


@app.route('/')
def index():
    """Display index page."""

    return render_template("index.html",
                           jskey=jskey)


####################################################
# JSON routes
####################################################

# I am a POST request so that the long JSON string is not passed as an argument.
@app.route('/request.json', methods=['POST'])
def handle_form():
    """Handles input from user."""

    # Get values from form.
    departure_day = request.form.get("departure-day")
    departure_time = request.form.get("departure-time")
    directions_result = dictify(request.form.get("data"))

    # directions_result = {u'routes': [{u'overview_polyline': u'cxcfFrkhiVu@qKzDOhIc@rEWfNu@pb@_CpUqABc@JOLKd@Lj@PVDjA?rCt@dBb@|Bp@|ErArA^B]@]QaDq@iKWcE~AM~DWvM}@b^eClZsB~Gi@pJm@pCUbHa@rCQTUtB\\tCj@zHrAbIvA`GbAhRfDdBXf@H`AR`Dj@dHlApDn@hCd@xCf@|Dl@zEv@jF|@fFv@lOdCrF~@~J|AbG~@BY^oAzDcNnMfH{AhF}ApFIE', u'warnings': [u"Bicycling directions are in beta. Use caution \u2013 This route may contain streets that aren't suited for bicycling."], u'bounds': {u'west': -122.27274000000001, u'east': -122.26345, u'north': 37.87181, u'south': 37.80339}, u'waypoint_order': [], u'summary': u'Telegraph Ave', u'copyrights': u'Map data \xa92016 Google', u'legs': [{u'distance': {u'text': u'5.4 mi', u'value': 8748}, u'traffic_speed_entry': [], u'end_address': u'Oakland, CA, USA', u'via_waypoint': [], u'via_waypoints': [], u'start_address': u'Berkeley, CA, USA', u'start_location': {u'lat': 37.8715417, u'lng': -122.27273809999997}, u'steps': [{u'distance': {u'text': u'0.1 mi', u'value': 179}, u'lat_lngs': [{u'lat': 37.87154, u'lng': -122.27274000000001}, {u'lat': 37.871570000000006, u'lng': -122.27252000000001}, {u'lat': 37.871590000000005, u'lng': -122.27234000000001}, {u'lat': 37.87165, u'lng': -122.27188000000001}, {u'lat': 37.87181, u'lng': -122.27073000000001}], u'travel_mode': u'BICYCLING', u'end_point': {u'lat': 37.8718087, u'lng': -122.27073029999997}, u'encoded_lat_lngs': u'cxcfFrkhiVEk@Cc@K{A_@eF', u'start_location': {u'lat': 37.8715417, u'lng': -122.27273809999997}, u'polyline': {u'points': u'cxcfFrkhiVEk@Cc@K{A_@eF'}, u'duration': {u'text': u'1 min', u'value': 41}, u'path': [{u'lat': 37.87154, u'lng': -122.27274000000001}, {u'lat': 37.871570000000006, u'lng': -122.27252000000001}, {u'lat': 37.871590000000005, u'lng': -122.27234000000001}, {u'lat': 37.87165, u'lng': -122.27188000000001}, {u'lat': 37.87181, u'lng': -122.27073000000001}], u'maneuver': u'', u'end_location': {u'lat': 37.8718087, u'lng': -122.27073029999997}, u'start_point': {u'lat': 37.8715417, u'lng': -122.27273809999997}, u'instructions': u'Head <b>east</b> on <b>University Ave</b> toward <b>Alameda County Bicycle Rte 35</b>/<b>Milvia St</b>'}, {u'distance': {u'text': u'1.1 mi', u'value': 1718}, u'lat_lngs': [{u'lat': 37.87181, u'lng': -122.27073000000001}, {u'lat': 37.871700000000004, u'lng': -122.27073000000001}, {u'lat': 37.87158, u'lng': -122.27072000000001}, {u'lat': 37.870960000000004, u'lng': -122.27065}, {u'lat': 37.870870000000004, u'lng': -122.27065}, {u'lat': 37.87057, u'lng': -122.27062000000001}, {u'lat': 37.869980000000005, u'lng': -122.27056}, {u'lat': 37.86981, u'lng': -122.27054000000001}, {u'lat': 37.869220000000006, u'lng': -122.27047}, {u'lat': 37.869060000000005, u'lng': -122.27045000000001}, {u'lat': 37.86881, u'lng': -122.27043}, {u'lat': 37.86836, u'lng': -122.27038}, {u'lat': 37.86816, u'lng': -122.27035000000001}, {u'lat': 37.868, u'lng': -122.27034}, {u'lat': 37.86744, u'lng': -122.27027000000001}, {u'lat': 37.86728, u'lng': -122.27025}, {u'lat': 37.86715, u'lng': -122.27024000000002}, {u'lat': 37.86652, u'lng': -122.27017000000001}, {u'lat': 37.86638000000001, u'lng': -122.27016}, {u'lat': 37.866170000000004, u'lng': -122.27013000000001}, {u'lat': 37.86572, u'lng': -122.27008000000001}, {u'lat': 37.865460000000006, u'lng': -122.27005000000001}, {u'lat': 37.86457, u'lng': -122.26994}, {u'lat': 37.86366, u'lng': -122.26984000000002}, {u'lat': 37.862750000000005, u'lng': -122.26974000000001}, {u'lat': 37.86265, u'lng': -122.26973000000001}, {u'lat': 37.86184, u'lng': -122.26964000000001}, {u'lat': 37.86095, u'lng': -122.26954}, {u'lat': 37.86003, u'lng': -122.26944}, {u'lat': 37.859120000000004, u'lng': -122.26933000000001}, {u'lat': 37.858230000000006, u'lng': -122.26924000000001}, {u'lat': 37.85732, u'lng': -122.26913}, {u'lat': 37.85642, u'lng': -122.26903000000001}], u'travel_mode': u'BICYCLING', u'maneuver': u'turn-right', u'end_point': {u'lat': 37.8564167, u'lng': -122.26903219999997}, u'encoded_lat_lngs': u'yycfF`_hiVT?VAzBMP?z@EtBK`@CtBM^Cp@CxAIf@E^AnBM^CXA|BMZAh@ExAIr@EpDUtDStDSRA`DQpDSvDStDUpDQtDUrDS', u'start_location': {u'lat': 37.8718087, u'lng': -122.27073029999997}, u'polyline': {u'points': u'yycfF`_hiVT?VAzBMP?z@EtBK`@CtBM^Cp@CxAIf@E^AnBM^CXA|BMZAh@ExAIr@EpDUtDStDSRA`DQpDSvDStDUpDQtDUrDS'}, u'duration': {u'text': u'5 mins', u'value': 310}, u'path': [{u'lat': 37.87181, u'lng': -122.27073000000001}, {u'lat': 37.871700000000004, u'lng': -122.27073000000001}, {u'lat': 37.87158, u'lng': -122.27072000000001}, {u'lat': 37.870960000000004, u'lng': -122.27065}, {u'lat': 37.870870000000004, u'lng': -122.27065}, {u'lat': 37.87057, u'lng': -122.27062000000001}, {u'lat': 37.869980000000005, u'lng': -122.27056}, {u'lat': 37.86981, u'lng': -122.27054000000001}, {u'lat': 37.869220000000006, u'lng': -122.27047}, {u'lat': 37.869060000000005, u'lng': -122.27045000000001}, {u'lat': 37.86881, u'lng': -122.27043}, {u'lat': 37.86836, u'lng': -122.27038}, {u'lat': 37.86816, u'lng': -122.27035000000001}, {u'lat': 37.868, u'lng': -122.27034}, {u'lat': 37.86744, u'lng': -122.27027000000001}, {u'lat': 37.86728, u'lng': -122.27025}, {u'lat': 37.86715, u'lng': -122.27024000000002}, {u'lat': 37.86652, u'lng': -122.27017000000001}, {u'lat': 37.86638000000001, u'lng': -122.27016}, {u'lat': 37.866170000000004, u'lng': -122.27013000000001}, {u'lat': 37.86572, u'lng': -122.27008000000001}, {u'lat': 37.865460000000006, u'lng': -122.27005000000001}, {u'lat': 37.86457, u'lng': -122.26994}, {u'lat': 37.86366, u'lng': -122.26984000000002}, {u'lat': 37.862750000000005, u'lng': -122.26974000000001}, {u'lat': 37.86265, u'lng': -122.26973000000001}, {u'lat': 37.86184, u'lng': -122.26964000000001}, {u'lat': 37.86095, u'lng': -122.26954}, {u'lat': 37.86003, u'lng': -122.26944}, {u'lat': 37.859120000000004, u'lng': -122.26933000000001}, {u'lat': 37.858230000000006, u'lng': -122.26924000000001}, {u'lat': 37.85732, u'lng': -122.26913}, {u'lat': 37.85642, u'lng': -122.26903000000001}], u'end_location': {u'lat': 37.8564167, u'lng': -122.26903219999997}, u'start_point': {u'lat': 37.8718087, u'lng': -122.27073029999997}, u'instructions': u'Turn <b>right</b> onto <b>Alameda County Bicycle Rte 35</b>/<b>Milvia St</b><div style="font-size:0.9em">Continue to follow Milvia St</div>'}, {u'distance': {u'text': u'115 ft', u'value': 35}, u'lat_lngs': [{u'lat': 37.85642, u'lng': -122.26903000000001}, {u'lat': 37.856410000000004, u'lng': -122.26891}, {u'lat': 37.8564, u'lng': -122.26885000000001}, {u'lat': 37.85638, u'lng': -122.26881000000002}, {u'lat': 37.85634, u'lng': -122.26877}, {u'lat': 37.85627, u'lng': -122.26871000000001}], u'travel_mode': u'BICYCLING', u'maneuver': u'turn-left', u'end_point': {u'lat': 37.856268, u'lng': -122.26871319999998}, u'encoded_lat_lngs': u'sy`fFltgiV@W@KBGFGLK', u'start_location': {u'lat': 37.8564167, u'lng': -122.26903219999997}, u'polyline': {u'points': u'sy`fFltgiV@W@KBGFGLK'}, u'duration': {u'text': u'1 min', u'value': 7}, u'path': [{u'lat': 37.85642, u'lng': -122.26903000000001}, {u'lat': 37.856410000000004, u'lng': -122.26891}, {u'lat': 37.8564, u'lng': -122.26885000000001}, {u'lat': 37.85638, u'lng': -122.26881000000002}, {u'lat': 37.85634, u'lng': -122.26877}, {u'lat': 37.85627, u'lng': -122.26871000000001}], u'end_location': {u'lat': 37.856268, u'lng': -122.26871319999998}, u'start_point': {u'lat': 37.8564167, u'lng': -122.26903219999997}, u'instructions': u'Turn <b>left</b> onto <b>Russell St</b>'}, {u'distance': {u'text': u'0.3 mi', u'value': 499}, u'lat_lngs': [{u'lat': 37.85627, u'lng': -122.26871000000001}, {u'lat': 37.856080000000006, u'lng': -122.26878}, {u'lat': 37.855900000000005, u'lng': -122.26885000000001}, {u'lat': 37.85586, u'lng': -122.26887}, {u'lat': 37.85582, u'lng': -122.26888000000001}, {u'lat': 37.85578, u'lng': -122.26889000000001}, {u'lat': 37.855760000000004, u'lng': -122.26890000000002}, {u'lat': 37.855740000000004, u'lng': -122.26890000000002}, {u'lat': 37.85571, u'lng': -122.26890000000002}, {u'lat': 37.85568, u'lng': -122.26890000000002}, {u'lat': 37.855630000000005, u'lng': -122.26890000000002}, {u'lat': 37.855560000000004, u'lng': -122.26889000000001}, {u'lat': 37.85548, u'lng': -122.26889000000001}, {u'lat': 37.8554, u'lng': -122.26890000000002}, {u'lat': 37.855380000000004, u'lng': -122.26890000000002}, {u'lat': 37.855360000000005, u'lng': -122.26890000000002}, {u'lat': 37.85533, u'lng': -122.26891}, {u'lat': 37.855290000000004, u'lng': -122.26892000000001}, {u'lat': 37.854870000000005, u'lng': -122.26908000000002}, {u'lat': 37.854620000000004, u'lng': -122.26917000000002}, {u'lat': 37.85423, u'lng': -122.26929000000001}, {u'lat': 37.854110000000006, u'lng': -122.26935000000002}, {u'lat': 37.85389, u'lng': -122.26944}, {u'lat': 37.853480000000005, u'lng': -122.26960000000001}, {u'lat': 37.853390000000005, u'lng': -122.26963}, {u'lat': 37.85314, u'lng': -122.26972}, {u'lat': 37.852650000000004, u'lng': -122.26992000000001}, {u'lat': 37.85237, u'lng': -122.27002000000002}, {u'lat': 37.85195, u'lng': -122.27018000000001}], u'travel_mode': u'BICYCLING', u'maneuver': u'turn-right', u'end_point': {u'lat': 37.8519506, u'lng': -122.27018040000002}, u'encoded_lat_lngs': u'ux`fFlrgiVd@Lb@LFBF@F@B@B?D?D?H?LAN?N@B?B?D@F@rA^p@PlAVVJj@PpA^PDp@P`Bf@v@RrA^', u'start_location': {u'lat': 37.856268, u'lng': -122.26871319999998}, u'polyline': {u'points': u'ux`fFlrgiVd@Lb@LFBF@F@B@B?D?D?H?LAN?N@B?B?D@F@rA^p@PlAVVJj@PpA^PDp@P`Bf@v@RrA^'}, u'duration': {u'text': u'2 mins', u'value': 136}, u'path': [{u'lat': 37.85627, u'lng': -122.26871000000001}, {u'lat': 37.856080000000006, u'lng': -122.26878}, {u'lat': 37.855900000000005, u'lng': -122.26885000000001}, {u'lat': 37.85586, u'lng': -122.26887}, {u'lat': 37.85582, u'lng': -122.26888000000001}, {u'lat': 37.85578, u'lng': -122.26889000000001}, {u'lat': 37.855760000000004, u'lng': -122.26890000000002}, {u'lat': 37.855740000000004, u'lng': -122.26890000000002}, {u'lat': 37.85571, u'lng': -122.26890000000002}, {u'lat': 37.85568, u'lng': -122.26890000000002}, {u'lat': 37.855630000000005, u'lng': -122.26890000000002}, {u'lat': 37.855560000000004, u'lng': -122.26889000000001}, {u'lat': 37.85548, u'lng': -122.26889000000001}, {u'lat': 37.8554, u'lng': -122.26890000000002}, {u'lat': 37.855380000000004, u'lng': -122.26890000000002}, {u'lat': 37.855360000000005, u'lng': -122.26890000000002}, {u'lat': 37.85533, u'lng': -122.26891}, {u'lat': 37.855290000000004, u'lng': -122.26892000000001}, {u'lat': 37.854870000000005, u'lng': -122.26908000000002}, {u'lat': 37.854620000000004, u'lng': -122.26917000000002}, {u'lat': 37.85423, u'lng': -122.26929000000001}, {u'lat': 37.854110000000006, u'lng': -122.26935000000002}, {u'lat': 37.85389, u'lng': -122.26944}, {u'lat': 37.853480000000005, u'lng': -122.26960000000001}, {u'lat': 37.853390000000005, u'lng': -122.26963}, {u'lat': 37.85314, u'lng': -122.26972}, {u'lat': 37.852650000000004, u'lng': -122.26992000000001}, {u'lat': 37.85237, u'lng': -122.27002000000002}, {u'lat': 37.85195, u'lng': -122.27018000000001}], u'end_location': {u'lat': 37.8519506, u'lng': -122.27018040000002}, u'start_point': {u'lat': 37.856268, u'lng': -122.26871319999998}, u'instructions': u'Turn <b>right</b> onto <b>Adeline St</b>'}, {u'distance': {u'text': u'0.2 mi', u'value': 361}, u'lat_lngs': [{u'lat': 37.85195, u'lng': -122.27018000000001}, {u'lat': 37.85193, u'lng': -122.27003}, {u'lat': 37.85192, u'lng': -122.26994}, {u'lat': 37.85192, u'lng': -122.26988000000001}, {u'lat': 37.851910000000004, u'lng': -122.26985}, {u'lat': 37.85192, u'lng': -122.26982000000001}, {u'lat': 37.85192, u'lng': -122.26977000000001}, {u'lat': 37.85201, u'lng': -122.26907000000001}, {u'lat': 37.852050000000006, u'lng': -122.26869}, {u'lat': 37.85211, u'lng': -122.26828}, {u'lat': 37.85215, u'lng': -122.26799000000001}, {u'lat': 37.85226, u'lng': -122.26710000000001}, {u'lat': 37.852380000000004, u'lng': -122.26612000000002}], u'travel_mode': u'BICYCLING', u'maneuver': u'turn-left', u'end_point': {u'lat': 37.8523792, u'lng': -122.26611689999999}, u'encoded_lat_lngs': u'u}_fFr{giVB]@Q?K@EAE?IQkCGkAKqAGy@UqDWcE', u'start_location': {u'lat': 37.8519506, u'lng': -122.27018040000002}, u'polyline': {u'points': u'u}_fFr{giVB]@Q?K@EAE?IQkCGkAKqAGy@UqDWcE'}, u'duration': {u'text': u'2 mins', u'value': 136}, u'path': [{u'lat': 37.85195, u'lng': -122.27018000000001}, {u'lat': 37.85193, u'lng': -122.27003}, {u'lat': 37.85192, u'lng': -122.26994}, {u'lat': 37.85192, u'lng': -122.26988000000001}, {u'lat': 37.851910000000004, u'lng': -122.26985}, {u'lat': 37.85192, u'lng': -122.26982000000001}, {u'lat': 37.85192, u'lng': -122.26977000000001}, {u'lat': 37.85201, u'lng': -122.26907000000001}, {u'lat': 37.852050000000006, u'lng': -122.26869}, {u'lat': 37.85211, u'lng': -122.26828}, {u'lat': 37.85215, u'lng': -122.26799000000001}, {u'lat': 37.85226, u'lng': -122.26710000000001}, {u'lat': 37.852380000000004, u'lng': -122.26612000000002}], u'end_location': {u'lat': 37.8523792, u'lng': -122.26611689999999}, u'start_point': {u'lat': 37.8519506, u'lng': -122.27018040000002}, u'instructions': u'Turn <b>left</b> onto <b>Woolsey St</b>'}, {u'distance': {u'text': u'1.4 mi', u'value': 2183}, u'lat_lngs': [{u'lat': 37.852380000000004, u'lng': -122.26612000000002}, {u'lat': 37.8519, u'lng': -122.26605}, {u'lat': 37.85157, u'lng': -122.26601000000001}, {u'lat': 37.85094, u'lng': -122.26593000000001}, {u'lat': 37.85034, u'lng': -122.26584000000001}, {u'lat': 37.849500000000006, u'lng': -122.26574000000001}, {u'lat': 37.84877, u'lng': -122.26564}, {u'lat': 37.848580000000005, u'lng': -122.26562000000001}, {u'lat': 37.84805, u'lng': -122.26554000000002}, {u'lat': 37.84780000000001, u'lng': -122.26551}, {u'lat': 37.84732, u'lng': -122.26544000000001}, {u'lat': 37.847060000000006, u'lng': -122.26541000000002}, {u'lat': 37.846590000000006, u'lng': -122.26535000000001}, {u'lat': 37.845870000000005, u'lng': -122.26525000000001}, {u'lat': 37.84452, u'lng': -122.26507000000001}, {u'lat': 37.8436, u'lng': -122.26495000000001}, {u'lat': 37.843450000000004, u'lng': -122.26493}, {u'lat': 37.84264, u'lng': -122.26482000000001}, {u'lat': 37.842020000000005, u'lng': -122.26474}, {u'lat': 37.841800000000006, u'lng': -122.26471000000001}, {u'lat': 37.841260000000005, u'lng': -122.26464000000001}, {u'lat': 37.84046, u'lng': -122.26453000000001}, {u'lat': 37.839560000000006, u'lng': -122.26441000000001}, {u'lat': 37.83921, u'lng': -122.26437000000001}, {u'lat': 37.838480000000004, u'lng': -122.26425}, {u'lat': 37.83827, u'lng': -122.26423000000001}, {u'lat': 37.83789, u'lng': -122.26417000000001}, {u'lat': 37.837770000000006, u'lng': -122.26416}, {u'lat': 37.83724, u'lng': -122.26410000000001}, {u'lat': 37.83684, u'lng': -122.26404000000001}, {u'lat': 37.83672, u'lng': -122.26403}, {u'lat': 37.83592, u'lng': -122.26393000000002}, {u'lat': 37.835660000000004, u'lng': -122.26389}, {u'lat': 37.835190000000004, u'lng': -122.26382000000001}, {u'lat': 37.834450000000004, u'lng': -122.26372}, {u'lat': 37.83373, u'lng': -122.26365000000001}, {u'lat': 37.83299, u'lng': -122.26356000000001}, {u'lat': 37.83288, u'lng': -122.26345}], u'travel_mode': u'BICYCLING', u'maneuver': u'turn-right', u'end_point': {u'lat': 37.8328833, u'lng': -122.26345420000001}, u'encoded_lat_lngs': u'k``fFfbgiV~AM`AG|BOvBQfDSpCSd@ChBOp@E~AMr@E|AKnCSlGc@vDW\\C`DUzBOj@EjBM~CUrDWdAGpCWh@CjAKVAhBKnAKVA~CSr@G|AMrCSnCMrCQTU', u'start_location': {u'lat': 37.8523792, u'lng': -122.26611689999999}, u'polyline': {u'points': u'k``fFfbgiV~AM`AG|BOvBQfDSpCSd@ChBOp@E~AMr@E|AKnCSlGc@vDW\\C`DUzBOj@EjBM~CUrDWdAGpCWh@CjAKVAhBKnAKVA~CSr@G|AMrCSnCMrCQTU'}, u'duration': {u'text': u'7 mins', u'value': 434}, u'path': [{u'lat': 37.852380000000004, u'lng': -122.26612000000002}, {u'lat': 37.8519, u'lng': -122.26605}, {u'lat': 37.85157, u'lng': -122.26601000000001}, {u'lat': 37.85094, u'lng': -122.26593000000001}, {u'lat': 37.85034, u'lng': -122.26584000000001}, {u'lat': 37.849500000000006, u'lng': -122.26574000000001}, {u'lat': 37.84877, u'lng': -122.26564}, {u'lat': 37.848580000000005, u'lng': -122.26562000000001}, {u'lat': 37.84805, u'lng': -122.26554000000002}, {u'lat': 37.84780000000001, u'lng': -122.26551}, {u'lat': 37.84732, u'lng': -122.26544000000001}, {u'lat': 37.847060000000006, u'lng': -122.26541000000002}, {u'lat': 37.846590000000006, u'lng': -122.26535000000001}, {u'lat': 37.845870000000005, u'lng': -122.26525000000001}, {u'lat': 37.84452, u'lng': -122.26507000000001}, {u'lat': 37.8436, u'lng': -122.26495000000001}, {u'lat': 37.843450000000004, u'lng': -122.26493}, {u'lat': 37.84264, u'lng': -122.26482000000001}, {u'lat': 37.842020000000005, u'lng': -122.26474}, {u'lat': 37.841800000000006, u'lng': -122.26471000000001}, {u'lat': 37.841260000000005, u'lng': -122.26464000000001}, {u'lat': 37.84046, u'lng': -122.26453000000001}, {u'lat': 37.839560000000006, u'lng': -122.26441000000001}, {u'lat': 37.83921, u'lng': -122.26437000000001}, {u'lat': 37.838480000000004, u'lng': -122.26425}, {u'lat': 37.83827, u'lng': -122.26423000000001}, {u'lat': 37.83789, u'lng': -122.26417000000001}, {u'lat': 37.837770000000006, u'lng': -122.26416}, {u'lat': 37.83724, u'lng': -122.26410000000001}, {u'lat': 37.83684, u'lng': -122.26404000000001}, {u'lat': 37.83672, u'lng': -122.26403}, {u'lat': 37.83592, u'lng': -122.26393000000002}, {u'lat': 37.835660000000004, u'lng': -122.26389}, {u'lat': 37.835190000000004, u'lng': -122.26382000000001}, {u'lat': 37.834450000000004, u'lng': -122.26372}, {u'lat': 37.83373, u'lng': -122.26365000000001}, {u'lat': 37.83299, u'lng': -122.26356000000001}, {u'lat': 37.83288, u'lng': -122.26345}], u'end_location': {u'lat': 37.8328833, u'lng': -122.26345420000001}, u'start_point': {u'lat': 37.8523792, u'lng': -122.26611689999999}, u'instructions': u'Turn <b>right</b> onto <b>Shattuck Ave</b>'}, {u'distance': {u'text': u'1.8 mi', u'value': 2958}, u'lat_lngs': [{u'lat': 37.83288, u'lng': -122.26345}, {u'lat': 37.83268, u'lng': -122.26349}, {u'lat': 37.83229, u'lng': -122.26360000000001}, {u'lat': 37.83202, u'lng': -122.26367}, {u'lat': 37.831790000000005, u'lng': -122.26374000000001}, {u'lat': 37.83173, u'lng': -122.26376}, {u'lat': 37.831540000000004, u'lng': -122.26382000000001}, {u'lat': 37.83126, u'lng': -122.2639}, {u'lat': 37.830870000000004, u'lng': -122.26399}, {u'lat': 37.830270000000006, u'lng': -122.26416}, {u'lat': 37.82996, u'lng': -122.26424000000002}, {u'lat': 37.829660000000004, u'lng': -122.26433000000002}, {u'lat': 37.8293, u'lng': -122.26442000000002}, {u'lat': 37.8292, u'lng': -122.26445000000001}, {u'lat': 37.82911, u'lng': -122.26447000000002}, {u'lat': 37.82902, u'lng': -122.26449000000001}, {u'lat': 37.82847, u'lng': -122.26464000000001}, {u'lat': 37.828410000000005, u'lng': -122.26466}, {u'lat': 37.828340000000004, u'lng': -122.26468000000001}, {u'lat': 37.828160000000004, u'lng': -122.26472000000001}, {u'lat': 37.828010000000006, u'lng': -122.26477000000001}, {u'lat': 37.827670000000005, u'lng': -122.26486000000001}, {u'lat': 37.82753, u'lng': -122.26490000000001}, {u'lat': 37.827470000000005, u'lng': -122.26492}, {u'lat': 37.827310000000004, u'lng': -122.26496000000002}, {u'lat': 37.827130000000004, u'lng': -122.26501}, {u'lat': 37.82705, u'lng': -122.26502}, {u'lat': 37.82697, u'lng': -122.26505000000002}, {u'lat': 37.826620000000005, u'lng': -122.26514000000002}, {u'lat': 37.826460000000004, u'lng': -122.26518000000002}, {u'lat': 37.826350000000005, u'lng': -122.26522000000001}, {u'lat': 37.82614, u'lng': -122.26527000000002}, {u'lat': 37.825660000000006, u'lng': -122.26540000000001}, {u'lat': 37.825390000000006, u'lng': -122.26547000000001}, {u'lat': 37.82506, u'lng': -122.26556000000001}, {u'lat': 37.824600000000004, u'lng': -122.26569}, {u'lat': 37.82442, u'lng': -122.26574000000001}, {u'lat': 37.82405, u'lng': -122.26583000000001}, {u'lat': 37.824040000000004, u'lng': -122.26584000000001}, {u'lat': 37.82396, u'lng': -122.26586}, {u'lat': 37.82395, u'lng': -122.26586}, {u'lat': 37.82394, u'lng': -122.26586}, {u'lat': 37.823820000000005, u'lng': -122.26589000000001}, {u'lat': 37.823820000000005, u'lng': -122.26590000000002}, {u'lat': 37.82381, u'lng': -122.26590000000002}, {u'lat': 37.82367, u'lng': -122.26593000000001}, {u'lat': 37.823660000000004, u'lng': -122.26594000000001}, {u'lat': 37.823530000000005, u'lng': -122.26597000000001}, {u'lat': 37.82345, u'lng': -122.26599000000002}, {u'lat': 37.823440000000005, u'lng': -122.26599000000002}, {u'lat': 37.823420000000006, u'lng': -122.266}, {u'lat': 37.82340000000001, u'lng': -122.26601000000001}, {u'lat': 37.82339, u'lng': -122.26601000000001}, {u'lat': 37.82338, u'lng': -122.26601000000001}, {u'lat': 37.823370000000004, u'lng': -122.26601000000001}, {u'lat': 37.823260000000005, u'lng': -122.26604}, {u'lat': 37.82325, u'lng': -122.26604}, {u'lat': 37.82325, u'lng': -122.26605}, {u'lat': 37.82292, u'lng': -122.26614000000001}, {u'lat': 37.82249, u'lng': -122.26625000000001}, {u'lat': 37.82211, u'lng': -122.26636}, {u'lat': 37.821690000000004, u'lng': -122.26648000000002}, {u'lat': 37.82135, u'lng': -122.26657000000002}, {u'lat': 37.820930000000004, u'lng': -122.26668000000001}, {u'lat': 37.820640000000004, u'lng': -122.26675000000002}, {u'lat': 37.820570000000004, u'lng': -122.26677000000001}, {u'lat': 37.820170000000005, u'lng': -122.26687000000001}, {u'lat': 37.82, u'lng': -122.26691000000001}, {u'lat': 37.819750000000006, u'lng': -122.26699}, {u'lat': 37.81942, u'lng': -122.26707}, {u'lat': 37.81906, u'lng': -122.26718000000001}, {u'lat': 37.81866, u'lng': -122.26728000000001}, {u'lat': 37.818290000000005, u'lng': -122.26738000000002}, {u'lat': 37.818200000000004, u'lng': -122.26740000000001}, {u'lat': 37.817930000000004, u'lng': -122.26747}, {u'lat': 37.81765, u'lng': -122.26754000000001}, {u'lat': 37.81734, u'lng': -122.26761}, {u'lat': 37.81716, u'lng': -122.26766}, {u'lat': 37.81689, u'lng': -122.26773000000001}, {u'lat': 37.81662, u'lng': -122.26780000000001}, {u'lat': 37.81624, u'lng': -122.26789000000001}, {u'lat': 37.81613, u'lng': -122.26793}, {u'lat': 37.815780000000004, u'lng': -122.26801}, {u'lat': 37.815450000000006, u'lng': -122.2681}, {u'lat': 37.81506, u'lng': -122.26820000000001}, {u'lat': 37.81467, u'lng': -122.26830000000001}, {u'lat': 37.814370000000004, u'lng': -122.26837}, {u'lat': 37.814150000000005, u'lng': -122.26842}, {u'lat': 37.813900000000004, u'lng': -122.26848000000001}, {u'lat': 37.81347, u'lng': -122.26859}, {u'lat': 37.81308000000001, u'lng': -122.26869}, {u'lat': 37.81261000000001, u'lng': -122.26881000000002}, {u'lat': 37.81232, u'lng': -122.26889000000001}, {u'lat': 37.81194, u'lng': -122.26898000000001}, {u'lat': 37.811840000000004, u'lng': -122.269}, {u'lat': 37.811510000000006, u'lng': -122.26909}, {u'lat': 37.81127, u'lng': -122.26915000000001}, {u'lat': 37.81105, u'lng': -122.26920000000001}, {u'lat': 37.81074, u'lng': -122.26929000000001}, {u'lat': 37.810340000000004, u'lng': -122.26939000000002}, {u'lat': 37.810050000000004, u'lng': -122.26947000000001}, {u'lat': 37.809580000000004, u'lng': -122.26958}, {u'lat': 37.80895, u'lng': -122.26974000000001}, {u'lat': 37.808350000000004, u'lng': -122.26989}, {u'lat': 37.808130000000006, u'lng': -122.26994}, {u'lat': 37.80792, u'lng': -122.26999}, {u'lat': 37.807590000000005, u'lng': -122.27007}, {u'lat': 37.80738, u'lng': -122.27012}, {u'lat': 37.806830000000005, u'lng': -122.27026000000001}], u'travel_mode': u'BICYCLING', u'maneuver': u'turn-slight-right', u'end_point': {u'lat': 37.8068304, u'lng': -122.27025789999999}, u'encoded_lat_lngs': u'of|eFpqfiVf@FlATt@Ll@LJBd@Jv@NlAPvB`@|@Nz@PfAPRDPBPBlB\\JBLBb@F\\HbAPZFJB^Fb@HN@NDdAP^FTFh@H~AXt@L`APzAXb@HhAP@@NB@?@?VD?@@?ZD@@XDNB@?B@B@@?@?@?TD@??@`APtATjATrAVbAPrATx@LLBnAR`@Fp@N`ANfATnARhARPBt@Lv@L|@Lb@Ht@Lt@LjAPTFdAN`APlARlARz@Lj@Hp@JtATlAR|AVx@NjAPRB`APn@Jj@H|@PnARx@N|AT|B^vB\\j@Hh@H`ANh@HlBZ', u'start_location': {u'lat': 37.8328833, u'lng': -122.26345420000001}, u'polyline': {u'points': u'of|eFpqfiVf@FlATt@Ll@LJBd@Jv@NlAPvB`@|@Nz@PfAPRDPBPBlB\\JBLBb@F\\HbAPZFJB^Fb@HN@NDdAP^FTFh@H~AXt@L`APzAXb@HhAP@@NB@?@?VD?@@?ZD@@XDNB@?B@B@@?@?@?TD@??@`APtATjATrAVbAPrATx@LLBnAR`@Fp@N`ANfATnARhARPBt@Lv@L|@Lb@Ht@Lt@LjAPTFdAN`APlARlARz@Lj@Hp@JtATlAR|AVx@NjAPRB`APn@Jj@H|@PnARx@N|AT|B^vB\\j@Hh@H`ANh@HlBZ'}, u'duration': {u'text': u'10 mins', u'value': 591}, u'path': [{u'lat': 37.83288, u'lng': -122.26345}, {u'lat': 37.83268, u'lng': -122.26349}, {u'lat': 37.83229, u'lng': -122.26360000000001}, {u'lat': 37.83202, u'lng': -122.26367}, {u'lat': 37.831790000000005, u'lng': -122.26374000000001}, {u'lat': 37.83173, u'lng': -122.26376}, {u'lat': 37.831540000000004, u'lng': -122.26382000000001}, {u'lat': 37.83126, u'lng': -122.2639}, {u'lat': 37.830870000000004, u'lng': -122.26399}, {u'lat': 37.830270000000006, u'lng': -122.26416}, {u'lat': 37.82996, u'lng': -122.26424000000002}, {u'lat': 37.829660000000004, u'lng': -122.26433000000002}, {u'lat': 37.8293, u'lng': -122.26442000000002}, {u'lat': 37.8292, u'lng': -122.26445000000001}, {u'lat': 37.82911, u'lng': -122.26447000000002}, {u'lat': 37.82902, u'lng': -122.26449000000001}, {u'lat': 37.82847, u'lng': -122.26464000000001}, {u'lat': 37.828410000000005, u'lng': -122.26466}, {u'lat': 37.828340000000004, u'lng': -122.26468000000001}, {u'lat': 37.828160000000004, u'lng': -122.26472000000001}, {u'lat': 37.828010000000006, u'lng': -122.26477000000001}, {u'lat': 37.827670000000005, u'lng': -122.26486000000001}, {u'lat': 37.82753, u'lng': -122.26490000000001}, {u'lat': 37.827470000000005, u'lng': -122.26492}, {u'lat': 37.827310000000004, u'lng': -122.26496000000002}, {u'lat': 37.827130000000004, u'lng': -122.26501}, {u'lat': 37.82705, u'lng': -122.26502}, {u'lat': 37.82697, u'lng': -122.26505000000002}, {u'lat': 37.826620000000005, u'lng': -122.26514000000002}, {u'lat': 37.826460000000004, u'lng': -122.26518000000002}, {u'lat': 37.826350000000005, u'lng': -122.26522000000001}, {u'lat': 37.82614, u'lng': -122.26527000000002}, {u'lat': 37.825660000000006, u'lng': -122.26540000000001}, {u'lat': 37.825390000000006, u'lng': -122.26547000000001}, {u'lat': 37.82506, u'lng': -122.26556000000001}, {u'lat': 37.824600000000004, u'lng': -122.26569}, {u'lat': 37.82442, u'lng': -122.26574000000001}, {u'lat': 37.82405, u'lng': -122.26583000000001}, {u'lat': 37.824040000000004, u'lng': -122.26584000000001}, {u'lat': 37.82396, u'lng': -122.26586}, {u'lat': 37.82395, u'lng': -122.26586}, {u'lat': 37.82394, u'lng': -122.26586}, {u'lat': 37.823820000000005, u'lng': -122.26589000000001}, {u'lat': 37.823820000000005, u'lng': -122.26590000000002}, {u'lat': 37.82381, u'lng': -122.26590000000002}, {u'lat': 37.82367, u'lng': -122.26593000000001}, {u'lat': 37.823660000000004, u'lng': -122.26594000000001}, {u'lat': 37.823530000000005, u'lng': -122.26597000000001}, {u'lat': 37.82345, u'lng': -122.26599000000002}, {u'lat': 37.823440000000005, u'lng': -122.26599000000002}, {u'lat': 37.823420000000006, u'lng': -122.266}, {u'lat': 37.82340000000001, u'lng': -122.26601000000001}, {u'lat': 37.82339, u'lng': -122.26601000000001}, {u'lat': 37.82338, u'lng': -122.26601000000001}, {u'lat': 37.823370000000004, u'lng': -122.26601000000001}, {u'lat': 37.823260000000005, u'lng': -122.26604}, {u'lat': 37.82325, u'lng': -122.26604}, {u'lat': 37.82325, u'lng': -122.26605}, {u'lat': 37.82292, u'lng': -122.26614000000001}, {u'lat': 37.82249, u'lng': -122.26625000000001}, {u'lat': 37.82211, u'lng': -122.26636}, {u'lat': 37.821690000000004, u'lng': -122.26648000000002}, {u'lat': 37.82135, u'lng': -122.26657000000002}, {u'lat': 37.820930000000004, u'lng': -122.26668000000001}, {u'lat': 37.820640000000004, u'lng': -122.26675000000002}, {u'lat': 37.820570000000004, u'lng': -122.26677000000001}, {u'lat': 37.820170000000005, u'lng': -122.26687000000001}, {u'lat': 37.82, u'lng': -122.26691000000001}, {u'lat': 37.819750000000006, u'lng': -122.26699}, {u'lat': 37.81942, u'lng': -122.26707}, {u'lat': 37.81906, u'lng': -122.26718000000001}, {u'lat': 37.81866, u'lng': -122.26728000000001}, {u'lat': 37.818290000000005, u'lng': -122.26738000000002}, {u'lat': 37.818200000000004, u'lng': -122.26740000000001}, {u'lat': 37.817930000000004, u'lng': -122.26747}, {u'lat': 37.81765, u'lng': -122.26754000000001}, {u'lat': 37.81734, u'lng': -122.26761}, {u'lat': 37.81716, u'lng': -122.26766}, {u'lat': 37.81689, u'lng': -122.26773000000001}, {u'lat': 37.81662, u'lng': -122.26780000000001}, {u'lat': 37.81624, u'lng': -122.26789000000001}, {u'lat': 37.81613, u'lng': -122.26793}, {u'lat': 37.815780000000004, u'lng': -122.26801}, {u'lat': 37.815450000000006, u'lng': -122.2681}, {u'lat': 37.81506, u'lng': -122.26820000000001}, {u'lat': 37.81467, u'lng': -122.26830000000001}, {u'lat': 37.814370000000004, u'lng': -122.26837}, {u'lat': 37.814150000000005, u'lng': -122.26842}, {u'lat': 37.813900000000004, u'lng': -122.26848000000001}, {u'lat': 37.81347, u'lng': -122.26859}, {u'lat': 37.81308000000001, u'lng': -122.26869}, {u'lat': 37.81261000000001, u'lng': -122.26881000000002}, {u'lat': 37.81232, u'lng': -122.26889000000001}, {u'lat': 37.81194, u'lng': -122.26898000000001}, {u'lat': 37.811840000000004, u'lng': -122.269}, {u'lat': 37.811510000000006, u'lng': -122.26909}, {u'lat': 37.81127, u'lng': -122.26915000000001}, {u'lat': 37.81105, u'lng': -122.26920000000001}, {u'lat': 37.81074, u'lng': -122.26929000000001}, {u'lat': 37.810340000000004, u'lng': -122.26939000000002}, {u'lat': 37.810050000000004, u'lng': -122.26947000000001}, {u'lat': 37.809580000000004, u'lng': -122.26958}, {u'lat': 37.80895, u'lng': -122.26974000000001}, {u'lat': 37.808350000000004, u'lng': -122.26989}, {u'lat': 37.808130000000006, u'lng': -122.26994}, {u'lat': 37.80792, u'lng': -122.26999}, {u'lat': 37.807590000000005, u'lng': -122.27007}, {u'lat': 37.80738, u'lng': -122.27012}, {u'lat': 37.806830000000005, u'lng': -122.27026000000001}], u'end_location': {u'lat': 37.8068304, u'lng': -122.27025789999999}, u'start_point': {u'lat': 37.8328833, u'lng': -122.26345420000001}, u'instructions': u'Slight <b>right</b> onto <b>Alameda County Bicycle Rte 35</b>/<b>Telegraph Ave</b><div style="font-size:0.9em">Continue to follow Telegraph Ave</div>'}, {u'distance': {u'text': u'0.2 mi', u'value': 287}, u'lat_lngs': [{u'lat': 37.806830000000005, u'lng': -122.27026000000001}, {u'lat': 37.806810000000006, u'lng': -122.27013000000001}, {u'lat': 37.806650000000005, u'lng': -122.26973000000001}, {u'lat': 37.80619, u'lng': -122.2685}, {u'lat': 37.805710000000005, u'lng': -122.26731000000001}], u'travel_mode': u'BICYCLING', u'maneuver': u'turn-left', u'end_point': {u'lat': 37.8057146, u'lng': -122.26731039999999}, u'encoded_lat_lngs': u'ucweFb|giVBY^oAzAuF~AmF', u'start_location': {u'lat': 37.8068304, u'lng': -122.27025789999999}, u'polyline': {u'points': u'ucweFb|giVBY^oAzAuF~AmF'}, u'duration': {u'text': u'1 min', u'value': 78}, u'path': [{u'lat': 37.806830000000005, u'lng': -122.27026000000001}, {u'lat': 37.806810000000006, u'lng': -122.27013000000001}, {u'lat': 37.806650000000005, u'lng': -122.26973000000001}, {u'lat': 37.80619, u'lng': -122.2685}, {u'lat': 37.805710000000005, u'lng': -122.26731000000001}], u'end_location': {u'lat': 37.8057146, u'lng': -122.26731039999999}, u'start_point': {u'lat': 37.8068304, u'lng': -122.27025789999999}, u'instructions': u'Turn <b>left</b> onto <b>17th St</b>'}, {u'distance': {u'text': u'0.2 mi', u'value': 289}, u'lat_lngs': [{u'lat': 37.805710000000005, u'lng': -122.26731000000001}, {u'lat': 37.804370000000006, u'lng': -122.26817000000001}, {u'lat': 37.80339, u'lng': -122.26879000000001}], u'travel_mode': u'BICYCLING', u'maneuver': u'turn-right', u'end_point': {u'lat': 37.8033922, u'lng': -122.2687876}, u'encoded_lat_lngs': u'u|veFtigiVjGjDbEzB', u'start_location': {u'lat': 37.8057146, u'lng': -122.26731039999999}, u'polyline': {u'points': u'u|veFtigiVjGjDbEzB'}, u'duration': {u'text': u'1 min', u'value': 52}, u'path': [{u'lat': 37.805710000000005, u'lng': -122.26731000000001}, {u'lat': 37.804370000000006, u'lng': -122.26817000000001}, {u'lat': 37.80339, u'lng': -122.26879000000001}], u'end_location': {u'lat': 37.8033922, u'lng': -122.2687876}, u'start_point': {u'lat': 37.8057146, u'lng': -122.26731039999999}, u'instructions': u'Turn <b>right</b> onto <b>Webster St</b>'}, {u'distance': {u'text': u'0.1 mi', u'value': 233}, u'lat_lngs': [{u'lat': 37.80339, u'lng': -122.26879000000001}, {u'lat': 37.803610000000006, u'lng': -122.26934000000001}, {u'lat': 37.803850000000004, u'lng': -122.26996000000001}, {u'lat': 37.804320000000004, u'lng': -122.27117000000001}], u'travel_mode': u'BICYCLING', u'maneuver': u'turn-right', u'end_point': {u'lat': 37.8043242, u'lng': -122.2711683}, u'encoded_lat_lngs': u'enveF|rgiVk@lBo@zB}ApF', u'start_location': {u'lat': 37.8033922, u'lng': -122.2687876}, u'polyline': {u'points': u'enveF|rgiVk@lBo@zB}ApF'}, u'duration': {u'text': u'1 min', u'value': 68}, u'path': [{u'lat': 37.80339, u'lng': -122.26879000000001}, {u'lat': 37.803610000000006, u'lng': -122.26934000000001}, {u'lat': 37.803850000000004, u'lng': -122.26996000000001}, {u'lat': 37.804320000000004, u'lng': -122.27117000000001}], u'end_location': {u'lat': 37.8043242, u'lng': -122.2711683}, u'start_point': {u'lat': 37.8033922, u'lng': -122.2687876}, u'instructions': u'Turn <b>right</b> onto <b>14th St</b>'}, {u'distance': {u'text': u'20 ft', u'value': 6}, u'lat_lngs': [{u'lat': 37.804320000000004, u'lng': -122.27117000000001}, {u'lat': 37.804370000000006, u'lng': -122.27114000000002}], u'travel_mode': u'BICYCLING', u'maneuver': u'turn-right', u'end_point': {u'lat': 37.8043732, u'lng': -122.27113939999998}, u'encoded_lat_lngs': u'_tveFxahiVIE', u'start_location': {u'lat': 37.8043242, u'lng': -122.2711683}, u'polyline': {u'points': u'_tveFxahiVIE'}, u'duration': {u'text': u'1 min', u'value': 14}, u'path': [{u'lat': 37.804320000000004, u'lng': -122.27117000000001}, {u'lat': 37.804370000000006, u'lng': -122.27114000000002}], u'end_location': {u'lat': 37.8043732, u'lng': -122.27113939999998}, u'start_point': {u'lat': 37.8043242, u'lng': -122.2711683}, u'instructions': u'Turn <b>right</b> onto <b>Broadway</b>'}], u'duration': {u'text': u'31 mins', u'value': 1867}, u'end_location': {u'lat': 37.8043732, u'lng': -122.27113939999998}}], u'overview_path': [{u'lat': 37.87154, u'lng': -122.27274000000001}, {u'lat': 37.87181, u'lng': -122.27073000000001}, {u'lat': 37.870870000000004, u'lng': -122.27065}, {u'lat': 37.869220000000006, u'lng': -122.27047}, {u'lat': 37.86816, u'lng': -122.27035000000001}, {u'lat': 37.86572, u'lng': -122.27008000000001}, {u'lat': 37.86003, u'lng': -122.26944}, {u'lat': 37.85642, u'lng': -122.26903000000001}, {u'lat': 37.8564, u'lng': -122.26885000000001}, {u'lat': 37.85634, u'lng': -122.26877}, {u'lat': 37.85627, u'lng': -122.26871000000001}, {u'lat': 37.856080000000006, u'lng': -122.26878}, {u'lat': 37.85586, u'lng': -122.26887}, {u'lat': 37.855740000000004, u'lng': -122.26890000000002}, {u'lat': 37.855360000000005, u'lng': -122.26890000000002}, {u'lat': 37.854620000000004, u'lng': -122.26917000000002}, {u'lat': 37.854110000000006, u'lng': -122.26935000000002}, {u'lat': 37.853480000000005, u'lng': -122.26960000000001}, {u'lat': 37.85237, u'lng': -122.27002000000002}, {u'lat': 37.85195, u'lng': -122.27018000000001}, {u'lat': 37.85193, u'lng': -122.27003}, {u'lat': 37.85192, u'lng': -122.26988000000001}, {u'lat': 37.85201, u'lng': -122.26907000000001}, {u'lat': 37.85226, u'lng': -122.26710000000001}, {u'lat': 37.852380000000004, u'lng': -122.26612000000002}, {u'lat': 37.8519, u'lng': -122.26605}, {u'lat': 37.85094, u'lng': -122.26593000000001}, {u'lat': 37.848580000000005, u'lng': -122.26562000000001}, {u'lat': 37.8436, u'lng': -122.26495000000001}, {u'lat': 37.83921, u'lng': -122.26437000000001}, {u'lat': 37.837770000000006, u'lng': -122.26416}, {u'lat': 37.83592, u'lng': -122.26393000000002}, {u'lat': 37.835190000000004, u'lng': -122.26382000000001}, {u'lat': 37.83373, u'lng': -122.26365000000001}, {u'lat': 37.83299, u'lng': -122.26356000000001}, {u'lat': 37.83288, u'lng': -122.26345}, {u'lat': 37.83229, u'lng': -122.26360000000001}, {u'lat': 37.831540000000004, u'lng': -122.26382000000001}, {u'lat': 37.82996, u'lng': -122.26424000000002}, {u'lat': 37.828340000000004, u'lng': -122.26468000000001}, {u'lat': 37.82705, u'lng': -122.26502}, {u'lat': 37.82396, u'lng': -122.26586}, {u'lat': 37.82345, u'lng': -122.26599000000002}, {u'lat': 37.82325, u'lng': -122.26604}, {u'lat': 37.82292, u'lng': -122.26614000000001}, {u'lat': 37.82211, u'lng': -122.26636}, {u'lat': 37.820640000000004, u'lng': -122.26675000000002}, {u'lat': 37.819750000000006, u'lng': -122.26699}, {u'lat': 37.81906, u'lng': -122.26718000000001}, {u'lat': 37.818290000000005, u'lng': -122.26738000000002}, {u'lat': 37.81734, u'lng': -122.26761}, {u'lat': 37.81624, u'lng': -122.26789000000001}, {u'lat': 37.81506, u'lng': -122.26820000000001}, {u'lat': 37.813900000000004, u'lng': -122.26848000000001}, {u'lat': 37.81127, u'lng': -122.26915000000001}, {u'lat': 37.810050000000004, u'lng': -122.26947000000001}, {u'lat': 37.808130000000006, u'lng': -122.26994}, {u'lat': 37.806830000000005, u'lng': -122.27026000000001}, {u'lat': 37.806810000000006, u'lng': -122.27013000000001}, {u'lat': 37.806650000000005, u'lng': -122.26973000000001}, {u'lat': 37.805710000000005, u'lng': -122.26731000000001}, {u'lat': 37.80339, u'lng': -122.26879000000001}, {u'lat': 37.803850000000004, u'lng': -122.26996000000001}, {u'lat': 37.804320000000004, u'lng': -122.27117000000001}, {u'lat': 37.804370000000006, u'lng': -122.27114000000002}]}], u'status': u'OK', u'geocoded_waypoints': [{u'place_id': u'ChIJ00mFOjZ5hYARk-l1ppUV6pQ', u'geocoder_status': u'OK', u'types': [u'locality', u'political']}, {u'place_id': u'ChIJA-2qKIt9hYARZ5N1NdUVtHE', u'geocoder_status': u'OK', u'types': [u'locality', u'political']}], u'request': {u'origin': u'Berkeley, CA', u'destination': u'Oakland, CA', u'travelMode': u'BICYCLING'}}

    # FIXME: Initial weather results are currently mocked.
    # result = make_result(directions_result, departure_time, departure_day)

    time.sleep(1)
    result = {'routeName': None, 'coordsTime': [((37.8715417, -122.27273809999997), '2016-09-07T17:00:00-07:00'), ((37.83921, -122.26437000000001), '2016-09-07T17:15:00-07:00'), ((37.80339, -122.26879000000001), '2016-09-07T17:30:00-07:00'), ((37.8043732, -122.27113939999998), '2016-09-07T17:31:07-07:00')], 'markerInfo': [{'fIcon': u'cloudy', 'fPrecipType': None, 'fSummary': u'Cloudy', 'fStatus': 'OK', 'fTime': '5:00 PM PDT', 'fPrecipProb': 0, 'lat': 37.8715417, 'lng': -122.27273809999997, 'fPrecipIntensity': 0, 'fTemp': 73.0}, {'fIcon': u'rain', 'fPrecipType': u'rain', 'fSummary': u'Rain', 'fStatus': 'OK', 'fTime': '5:15 PM PDT', 'fPrecipProb': 100, 'lat': 37.83921, 'lng': -122.26437000000001, 'fPrecipIntensity': 0.4, 'fTemp': 70.0}, {'fIcon': u'cloudy', 'fPrecipType': None, 'fSummary': u'Cloudy', 'fStatus': 'OK', 'fTime': '5:30 PM PDT', 'fPrecipProb': 0, 'lat': 37.80339, 'lng': -122.26879000000001, 'fPrecipIntensity': 0, 'fTemp': 70.0}, {'fIcon': u'cloudy', 'fPrecipType': None, 'fSummary': u'Cloudy', 'fStatus': 'OK', 'fTime': '5:31 PM PDT', 'fPrecipProb': 0, 'lat': 37.8043732, 'lng': -122.27113939999998, 'fPrecipIntensity': 0, 'fTemp': 70.0}], 'weatherReport': {'snowProb': 0.0, 'rainMax': 0.1, 'avgTemp': 71.0, 'sleetMax': 0, 'snowMax': 0, 'maxIntensity': 0.1, 'modalWeather': u'cloudy', 'sleetProb': 0.0, 'precipProb': 100.0, 'rainProb': 100.0}}

    return jsonify(result)


@app.route('/recommendation.json', methods=['POST'])
def handle_recs():
    """Handles request for recommendation."""

    # Get values from form.
    minutes_before = int(request.form.get("before"))
    minutes_after = int(request.form.get("after"))
    data = dictify(request.form.get("data"))

    result = make_recommendation(data, minutes_before, minutes_after)

    return jsonify(result)


# The following code is based on my implementation of Hackbright's Ratings
# exercise, which I pair programmed with Jennifer Griffith-Delgado (jgriffith23).

####################################################
# User profile routes
####################################################
@app.route('/settings', methods=['GET'])
def display_settings():
    """Show a user's profile page."""

    # Check that user is logged in.
    user_id = session.get("user_id")

    # If they're not logged in, redirect them to the homepage.
    if not user_id:
        return redirect("/")

    else:
        user = User.query.filter(User.user_id == user_id).first()
        print user

        return render_template("settings.html", user=user)


@app.route('/settings', methods=['POST'])
def update_settings():
    """Update a user's preferences in the database."""

    # Check that user is logged in.
    user_id = session.get("user_id")

    # If they're not logged in, redirect them to the homepage.
    if not user_id:
        return redirect("/")

    else:
        # Get values from form.
        temp_pref = request.form.get("temp-pref")
        rec_sense = request.form.get("rec-sense")

        # Convert these values into those usable by database.
        # Temperature preference is a boolean (T/F) re: Celsius.
        if temp_pref == "cel":
            temp_pref = True
        else:
            temp_pref = False

        # Sensitivity is an integer.
        if rec_sense == "low":
            rec_sense = 1

        elif rec_sense == "high":
            rec_sense = 5

        else:
            rec_sense = 3

        # Fetch and update user's record.
        user = User.query.filter(User.user_id == user_id).first()

        user.celsius = temp_pref
        user.sensitivity = rec_sense

        db.session.commit()

        return redirect("/settings")


####################################################
# Registration routes
####################################################

@app.route('/register', methods=['GET'])
def register_form():
    """Displays the registration form."""

    return render_template("register_form.html")


@app.route('/register', methods=['POST'])
def handle_register():
    """Handles input from registration form."""

    email = request.form.get("email")
    password = request.form.get("password")
    fname = request.form.get("first-name")
    lname = request.form.get("last-name")

    # Python's built-in hash function is not cryptographically secure; we're
    # just using it for convenience.
    password = hash(password)

    user = User.query.filter(User.email == email).first()

    if user:
        flash("That email has already been registered.")
        return redirect("/register")
    else:
        # If the user doesn't exist, create one.
        user = User(email=email, password=password, fname=fname, lname=lname)
        db.session.add(user)
        db.session.commit()

        #Code 307 preserves the POST request, including form data.
        return redirect("/login", code=307)


####################################################
# Authentication/Deauthentication routes
####################################################

@app.route('/login', methods=['POST'])
def handle_login():
    """Handles input from login form."""

    print request.form

    email = request.form.get("email")
    password = request.form.get("password")

    # Python's built-in hash function is not cryptographically secure; we're
    # just using it for convenience.

    # We need to convert the hash to unicode because hash() returns an integer
    # but it's stored in the database as a unicode string.

    password = unicode(hash(password))

    user = User.query.filter(User.email == email).first()

    if user:
        if password != user.password:
            return redirect("/")
        else:
            # Add their user_id and first name to session.
            session["user_id"] = user.user_id
            session["fname"] = user.fname

            print "Session:", session

            return redirect("/")

    else:
        return redirect("/")


@app.route('/logout')
def logout():

    if "user_id" in session:
        del session["user_id"]
        del session["fname"]

    print "Session", session

    return redirect("/")

################################################################################

if __name__ == "__main__":

    # Set debug = True in order to invoke the DebugToolbarExtension.
    app.debug = True

    # Use the DebugToolbarExtension.
    # DebugToolbarExtension(app)

    # There's currently a bug in flask 0.11 that prevents template reloading.
    app.jinja_env.auto_reload = True

    # Connect to database.
    connect_to_db(app)

    # Must specify host for Vagrant.
    app.run(host="0.0.0.0")
    # app.run()
